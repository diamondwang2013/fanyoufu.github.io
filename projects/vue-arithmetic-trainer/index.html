<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style>
		html,body{font-size: 20px;}
		a{text-decoration: none;}
		.container{
			margin:20px auto;
			width: 40rem;
			padding:2em;
			background-color: #eee;
		}
		#app{position: relative;}
		#scoreList{
			transition: all .5s;
		}
		.end{
			position: absolute;
			top: 0;
			background: #fff;
			width: 100%;
			padding: 10px;
		}
		.subArea{display:flex;}
		.subArea span{font-size: 6rem;}
		.subArea button{width: 5rem;margin-left:0.5rem;}
		ul{list-style: none}
		ul > li{display: inline-block;border:1px solid #ccc;padding:1em;margin-right:5px;}
		.cur{border-color: red; font-weight: bold;}
		input{padding:3px;width:7rem;line-height:6rem;text-align: center;font-size: 3rem;}
		input.result{position: relative;}

		.result::after{
			content: "";
			position: absolute;
			top:0;
			left:0;
			border:1px solid red;
			width: 50px;
			height: 50px;
		}
		.right{color:green}
		.error{color:red}
		.idx{background-color: grey;color:#fff;padding:3px;margin-right: 5px;}
		.fs2{font-size: 2em;}
	</style>
</head>
<body>
	<div class="container">	
		<h1>四则运算器</h1>
		<div id="app">
			<ul>
				<li :class="{cur:op==='+'}" @click="changeOp('+')"> + </li>
				<li :class="{cur:op==='-'}" @click="changeOp('-')"> - </li>
				<li :class="{cur:op==='*'}" @click="changeOp('*')"> * </li>
				<li :class="{cur:op==='/'}" @click="changeOp('/')"> / </li>
			</ul>
			<div class="subArea">
				<input type="text" :value="num1" disabled> 
				<span>{{op}}</span>
				<input type="text" :value="num2" disabled>
				<span>=</span>
				<input class="result" ref="result" type="text" v-model="result" v-on:keyup.enter="checkAns" :disabled="isTimeout"/>
	
				<button @click="checkAns" :disabled="isTimeout">检查</button>
			</div>
			<div id="scoreList" :class="{'end':isTimeout}">
				<p>剩余时间:{{time}}</p>
				<div>
					<h2>已答{{list.length}}题 - 正确{{list.filter(i=>i.isRight).length}}题</h2>
					<p v-for="(item,index) in list" :class="item.isRight ? 'right' :'error'">
						<span class="idx">{{index+1}} </span>{{item.subStr}} 
						<span v-if="item.isRight">right</span>
						<span v-else>error - {{item.ans}}</span>
					</p>
				</div>
				<a class="fs2" href="index.html" v-show="isTimeout"> 再来</a>
			</div>
		</div>
	</div>
<script src="https://cdn.bootcss.com/vue/2.6.8/vue.js"></script>
<script src="./subject.js"></script>
<script>
	function Timer(second){
		this.listenerList = {"start":[],"normal":[],"end":[]}
		this.second = second

		this.timerId = setInterval(()=>{
			if(this.second == 0){
				clearInterval(this.timerId);
				this.fire("end")
				return;
			}
			this.second--;
			this.fire();
		},500)

	}

	Timer.prototype.addListener = function(f,status="normal"){
		this.listenerList[status].push(f,)
	} 
	Timer.prototype.removeListener = function(f,status="normal"){
		let index = this.listenerList[status].find(item => item === f)
		this.listenerList[status].splice(index,1);
	}
	Timer.prototype.fire = function(status="normal"){
		this.listenerList[status].forEach(item=>{
			item(this.second);
		})
	}
	
	window.addEventListener("load",()=>{
		let timer = new Timer(60*1)
		let subject = new Subject();
		let vm = new Vue({
			el:"#app",
			data:{
				num1:subject.num1,
				num2:subject.num2,
				op:"+",
				result:"",
				time:0,
				list:[],
				isTimeout:false,
			},
			mounted() {
				this.$refs.result.focus()
				
			},
			methods:{
				changeOp(op){
					this.op = op;
					subject.setOperator(this.op);
					this.$refs.result.focus()
				},
				next(){
					subject.next();
					this.num1 = subject.num1;
					this.num2 = subject.num2;
				},
				checkAns(){
					if(this.result == subject.result){
						this.list.unshift({subStr:subject.toString(),ans:this.result,isRight:true})
					}
					else{
						this.list.unshift({subStr:subject.toString(),ans:this.result,isRight:false})
					}
					this.result = "";
					this.$refs.result.focus()
					this.next();
		
				}
			}
		})

		timer.addListener((t)=>{
			vm.time = t;
		})
		timer.addListener(()=>{
			vm.isTimeout = true;
			// document.getElementById("scoreList").classList.add("end")
		},"end")
	});

	
</script>
</body>
</html>